---
title: "[GraphQL] GraphQL로 API만들기 (2) - GraphQL 쿼리, 뮤테이션, 스키마, 리졸버"
date: 2020-08-30 20:00:00 +0900
categories: [1.Studying, GraphQL]
tags: [GraphQL, API, 오픈API]

---



##  **GraphQl로 API 만들기 (2) - 쿼리, 뮤테이션, 스키마, 리졸버**

------

### **👍 GraphQL의 구조**

Graphql 사용 목적 자체가 클라이언트에서 데이터를 **서버로부터 간편하고, 효율적으로 가져오는 것**입니다.

그리고 이 때 데이터를 가져오기 위해 **쿼리(Query)를 사용**합니다. 즉, DB 서버로부터 **쿼리**를 통해 무언가 요청하는 과정을 거칩니다.

여기에서 잠시 **GraphQL의 구조**를 살펴볼 필요가 있을 것 같습니다.

------



#### **📙 쿼리, 뮤테이션(Query, Mutation)**

쿼리는 단지 **정보를 읽어올 **때만 사용하는 것으로 이해하시면 됩니다. 예를 들어 다음과 같습니다.

* **`쿼리문(요청)`** : user의 name을 쿼리로 요청한다.

```
query {
	user{
		name
	}
}
```

* **`응답`** : 쿼리문에 대한 응답이 데이터로 반환된다.

```
{
	"data":{
		"user": {
			"name": "abcde"
		}
	}
}
```

반면 뮤테이션(Mutation)은 **받아온 정보를 변형**하고자 할 때 사용합니다. 다시 말하자면, 쿼리가 CRUD에서 R 이라면, 뮤테이션은 CUD 부분을 맡습니다.

* **`뮤테이션 요청 예시`**

```
mutation {
	addMovie(name:"Rocks"){
		name
	}
}
```

addMovie 라는 뮤테이션이 정의되어 있고, 이를 통해 새로운 이름의 영화를 추가(C) 하는 예시

------

#### **📙 스키마, 리졸버(Schema, Resolver)**

그런데 위의 쿼리나 뮤테이션을 그냥 사용할 수는 없습니다. 어딘가에서 정의된 것이 분명할 텐데, GraphQL에서는 **스키마**에 정의합니다.

**schema.graphql 이라는 파일** 내에 작성하게 되며, 사용할 **쿼리나 뮤테이션, type 등을 정의**합니다. 즉, 사용할 데이터들에 대한 설명을 스키마에 작성한다고 생각하면 됩니다.

사용자는 추후에 쿼리문을 작성할 때, **스키마에 정의된 대로 argument 등을 정확히 맞추어** 요청해야 합니다.

* **`스키마 파일의 예시`**

```js
type Movie {
  id: Int!
  title: String!
  rating: Float
  description_intro: String
  language: String
  medium_cover_image: String
  genres: [String]
}

type Query {
  movies(limit: Int, rating: Float): [Movie]!
  movie(id: Int!): Movie
  suggestions(id: Int!): [Movie]!
}
  
type Mutation {
    ...
}
```

사용할 쿼리나 뮤테이션은 반드시 위와 같이 **type Query, type Mutation 내부에 작성해야 하는 규칙**을 지켜야 합니다.

그런데 정의만 한다고 해서 데이터의 읽기, 쓰기, 업데이트 등이 알아서 되진 않겠죠? 데이터를 읽어오거나, 데이터를 추가 혹은 삭제 등의 **기능을 구현**해야 합니다.

그리고 **그 기능 구현을 리졸버에 작성**합니다. **리졸버(resolver)란, 쉽게 말해 쿼리를 해결하는 것**을 말합니다.

스키마에서 정의한 **각각의 필드마다, 함수를 하나씩 구현**한다고 생각하면 됩니다.

* **`리졸버의 예시`**

```js
import { getMovies, getMovie, getSuggestions } from "./db";

const resolvers = {
  Query: {
    movies: (_, { rating, limit }) => getMovies(limit, rating),
    movie: (_, { id }) => getMovie(id),
    suggestions: (_, { id }) => getSuggestions(id)
  }
};

export default resolvers;
```

get~ 함수들을 모두 구현하고, resolvers.js 파일 내에 위와 같이 작성한 모습입니다. 그러면 graphql이 위의 리졸버를 보고, 쿼리를 어떻게 해결할 지 알 수 있게 됩니다.



------

## **✍ 2. 쿼리와 리졸버 정의하기 **

이제 GraphQL로 본격적인 API를 만들어 보겠습니다.

이 포스팅에서 GraphQL로 API를 만든다는 것은, **REST API로 제공되는 오픈API를 GraphQL로 래핑**한다는 의미입니다. 

request 등 다양한 면에서 REST API보다 GraphQL이 효율적일 수 있다는 점은 다른 포스팅에서 많이 언급한 적이 있습니다.

기존에 REST API로 제공되어 fetch 등을 통해 데이터를 받아야 했던 오픈API를, **GraphQL 서버를 만들어서 쿼리로 요청하고 데이터를 받을 수 있게 만드는 것이 목적**입니다.

이렇게 GraphQL을 통해서 좀 더 간편하게 만들어 둔다면, 추후에 클라이언트 단에서는 데이터를 효율적으로 가져올 수 있을 것입니다.

------



#### **📲 사용한 오픈API** : 카트라이더 오픈 API([https://developers.nexon.com/kart](https://developers.nexon.com/kart))

많은 오픈API들 중에서 저는 **카트라이더가 제공하는 오픈API**를 사용해 보기로 하였습니다. 이 글을 보시는 분들은 굳이 이 오픈API가 아니더라도 원하는 다른 오픈API를 선택하셔도 무방합니다. 설명은 카트라이더 API 기준으로 진행하도록 하겠습니다.

